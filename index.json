[{"categories":null,"content":"这个页面是个人简介 一个咸鱼的互助网之路，自己做些笔记。 ","date":"0001-01-01","objectID":"/about/:0:0","tags":null,"title":"","uri":"/about/"},{"categories":null,"content":" openwrt 编译记录 ","date":"0001-01-01","objectID":"/openwrt%E7%BC%96%E8%AF%91/:0:0","tags":null,"title":"","uri":"/openwrt%E7%BC%96%E8%AF%91/"},{"categories":null,"content":"编译 ","date":"0001-01-01","objectID":"/openwrt%E7%BC%96%E8%AF%91/:1:0","tags":null,"title":"","uri":"/openwrt%E7%BC%96%E8%AF%91/"},{"categories":null,"content":"首先得搭一个环境 在 ubuntu-20.04 上运行命令，将环境搭建好： apt-get update \u0026\u0026 apt-get install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch python3 python2.7 unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs git-core gcc-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler g++-multilib antlr3 gperf wget curl swig rsync -y ","date":"0001-01-01","objectID":"/openwrt%E7%BC%96%E8%AF%91/:1:1","tags":null,"title":"","uri":"/openwrt%E7%BC%96%E8%AF%91/"},{"categories":null,"content":"新建用户 adduser openwrt usermod -a -G sudo openwrt su openwrt ./scripts/feeds update -a \u0026\u0026 ./scripts/feeds install -a ","date":"0001-01-01","objectID":"/openwrt%E7%BC%96%E8%AF%91/:1:2","tags":null,"title":"","uri":"/openwrt%E7%BC%96%E8%AF%91/"},{"categories":null,"content":"添加自定义源 cat \u003e\u003e feeds.conf.default \u003c\u003cEOF src-git kenzo https://github.com/kenzok8/openwrt-packages src-git small https://github.com/kenzok8/small EOF 或 sed -i '$a src-git kenzo https://github.com/kenzok8/openwrt-packages' feeds.conf.default sed -i '$a src-git small https://github.com/kenzok8/small' feeds.conf.default ","date":"0001-01-01","objectID":"/openwrt%E7%BC%96%E8%AF%91/:1:3","tags":null,"title":"","uri":"/openwrt%E7%BC%96%E8%AF%91/"},{"categories":null,"content":"配置环境环境 .config make menuconfig # M 表示选中插件但不编译进固件 # （）不选择 # * 选中并编译 Target System (x86) ---\u003e 目标系统（x86） Subtarget (x86_64) ---\u003e 子目标（x86_64） Target Profile (Generic) ---\u003e目标配置文件（通用） Target Images ---\u003e 保存目标镜像的格式 Global build settings ---\u003e 全局构建设置 Advanced configuration options (for developers) ---- 高级配置选项（适用于开发人员） Build the OpenWrt Image Builder 构建OpenWrt图像生成器 Build the OpenWrt SDK 构建OpenWrt SDK Package the OpenWrt-based Toolchain 打包基于OpenWrt的工具链 Image configuration ---\u003e图像配置 Base system ---\u003e 基本系统 Administration ---\u003e 管理 Boot Loaders ---\u003e 引导加载程序 Development ---\u003e 开发 Extra packages ---\u003e 额外包 Firmware ---\u003e固件 Fonts ---\u003e字体 Kernel modules ---\u003e 内核模块 Languages ---\u003e语言 Libraries ---\u003e 图书馆 LuCI ---\u003e LuCI Mail ---\u003e 邮件 Multimedia ---\u003e多媒体 Network ---\u003e网络 Sound ---\u003e 声音 Utilities ---\u003e实用程序 Xorg ---\u003eXorg ## 选择系统(以 x86_64 为例) Target System -\u003e x86 Subtarget -\u003e x86_64 ## 选择固件的文件系统 ## https://openwrt.org/docs/techref/filesystems Target Images -\u003e squashfs ## 选择构建X86_X64的GRUB固件 Target Images -\u003e Build GRUB images (Linux x86 or x86_64 host only) ## 选择更小的压缩格式固件，方便复制 Target Images -\u003e GZip images ## 修改软件包可用空间，默认安装会占用100M左右，建议修改扩大，为后续安装其他软件打基础 Target Images -\u003e Root filesystem partition size ## 添加web界面(y键选择n键排除) LuCI \u003e Collections -\u003e Luci ## 添加兼容性依赖 LuCI \u003e Modules -\u003e luci-compat ## 添加中文 LuCI \u003e Modules -\u003e Translations -\u003e Chinese Simplified ## 添加openclash LuCI \u003e Applications -\u003e luci-app-openclash ## 添加主题 LuCI -\u003e Themes ## 添加wget Nerwork -\u003e File Transfer -\u003e wget-nossl Nerwork -\u003e File Transfer -\u003e wget-ssl ## 添加kmod-tun，TUN模式必须 Kernel modules -\u003e Network Support -\u003e kmod-tun ## 排除dnsmasq，由于默认会安装dnsmasq-full，这里需要排除dnsmasq，否则会冲突报错。 Base system -\u003e dnsmasq ","date":"0001-01-01","objectID":"/openwrt%E7%BC%96%E8%AF%91/:1:4","tags":null,"title":"","uri":"/openwrt%E7%BC%96%E8%AF%91/"},{"categories":null,"content":"导出.config 用于云端编译 ./scripts/diffconfig.sh \u003e yun.config ","date":"0001-01-01","objectID":"/openwrt%E7%BC%96%E8%AF%91/:1:5","tags":null,"title":"","uri":"/openwrt%E7%BC%96%E8%AF%91/"},{"categories":null,"content":"下载 dl 库（国内请尽量全局科学上网），8 线程，如需看详细日志加 V=s make download -j8 ","date":"0001-01-01","objectID":"/openwrt%E7%BC%96%E8%AF%91/:1:6","tags":null,"title":"","uri":"/openwrt%E7%BC%96%E8%AF%91/"},{"categories":null,"content":"其它命令 # 多线程编译 make -j $(($(nproc)+1)) || make -j1 || make -j1 V=s # 仅清理编译结果（bin 目录） make clean # 清理所有编译文件（除了.config、dl 文件夹和 feeds 以外都清理） make dirclean # 清理所有编译文件以及相关依赖（完全清理干净，一键回到刚 git clone 下来的时候） make distclean # 更改配置编译 rm -rf ./tmp \u0026\u0026 rm -rf .config make menuconfig make -j$(($(nproc) + 1)) V=s ","date":"0001-01-01","objectID":"/openwrt%E7%BC%96%E8%AF%91/:2:0","tags":null,"title":"","uri":"/openwrt%E7%BC%96%E8%AF%91/"},{"categories":null,"content":"更改 LAN 口的默认 IP 地址 vim package/base-files/files/bin/config_generate ","date":"0001-01-01","objectID":"/openwrt%E7%BC%96%E8%AF%91/:2:1","tags":null,"title":"","uri":"/openwrt%E7%BC%96%E8%AF%91/"},{"categories":null,"content":"单独编译插件 ## 下载OpenClash wget https://github.com/vernesong/OpenClash/archive/master.zip ## 解压 unzip master.zip ## 复制OpenClash软件包到OpenWrt cp -r OpenClash-master/luci-app-openclash openwrt/package ./scripts/feeds update -a ./scripts/feeds install -a ## 删除旧的openclash文件 rm -rf master.zip \u0026\u0026 rm -rf OpenClash-master \u0026\u0026 rm -rf openwrt/package/luci-app-openclash ","date":"0001-01-01","objectID":"/openwrt%E7%BC%96%E8%AF%91/:2:2","tags":null,"title":"","uri":"/openwrt%E7%BC%96%E8%AF%91/"},{"categories":null,"content":"pve 导入镜像 ## 转换成 PVE 磁盘格式，注意其中的112替换为你的VM ID ./img2kvm openwrt-x86-64-generic-squashfs-combined.img 112 vm-112-disk-1 ","date":"0001-01-01","objectID":"/openwrt%E7%BC%96%E8%AF%91/:3:0","tags":null,"title":"","uri":"/openwrt%E7%BC%96%E8%AF%91/"}]